{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Carrigar by Tubematic</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body { background: #f8f9fa; font-family: 'Poppins', Arial, sans-serif; }
        .logo-img { max-width: 180px; width: 100%; }
        .header-bar { display: flex; align-items: center; justify-content: space-between; padding: 1.5rem 0 1rem 0; }
        .login-btn { font-weight: 500; border-radius: 2rem; padding: 0.5rem 1.5rem; background: #22c55e; color: #fff; border: none; transition: background 0.2s; text-decoration: none; }
        .login-btn:hover { background: #0d6efd; color: #fff; text-decoration: none; }
        .order-tabs-compartment { background: #fff; border-radius: 1rem; box-shadow: 0 2px 8px #0001; padding: 2rem 1rem; margin-bottom: 2rem; }
        .services-compartment { background: #fff; border-radius: 1rem; box-shadow: 0 2px 8px #0001; padding: 2rem 1rem; margin-bottom: 2rem; }
        .why-compartment { background: #e9f5ff; border-radius: 1rem; box-shadow: 0 2px 8px #0001; padding: 2rem 1rem; margin-bottom: 2rem; }
        .tube-laser-compartment { background: #e6f9f0; border-radius: 1rem; box-shadow: 0 2px 8px #0001; padding: 2rem 1rem; margin-bottom: 2rem; }
        .testimonials-compartment { background: #f4f4f4; border-radius: 1rem; box-shadow: 0 2px 8px #0001; padding: 2rem 1rem; margin-bottom: 2rem; }
        .clients-compartment { background: #fff; border-radius: 1rem; box-shadow: 0 2px 8px #0001; padding: 2rem 1rem; margin-bottom: 2rem; }
        .service-icon { font-size: 2.5rem; color: #0d6efd; }
        .service-card { border: none; border-radius: 1rem; box-shadow: 0 1px 4px #0001; transition: box-shadow 0.2s, border 0.2s; }
        .service-card:hover { box-shadow: 0 4px 16px #22c55e33; border: 1.5px solid #22c55e; }
        .btn-primary, .btn-outline-primary.active, .btn-primary:active { background: #0d6efd; border-color: #0d6efd; }
        .btn-outline-primary { color: #22c55e; border-color: #22c55e; }
        .btn-outline-primary:hover, .btn-outline-primary:focus { background: #22c55e; color: #fff; border-color: #22c55e; }
        .progress-bar { background-color: #22c55e; }
        .client-logo { font-size: 1.1rem; background: #e9f5ff; border-radius: 0.5rem; box-shadow: 0 1px 4px #0001; padding: 1rem 2rem; margin: 0.5rem; color: #0d6efd; font-weight: 600; }
        h1, h2, h3, h4, h5, h6 { font-weight: 600; }
        .why-compartment i, .tube-laser-compartment i { color: #22c55e !important; }
        .nav-link { color: #333 !important; font-weight: 500; margin: 0 0.5rem; }
        .nav-link:hover { color: #0d6efd !important; }
    </style>
</head>
<body>
<div class="container">
    <!-- Header -->
    <div class="header-bar">
        <img src="{% static 'core/logo.jpeg' %}" alt="Carrigar by Tubematic Logo" class="logo-img">
        <div class="d-flex align-items-center">
            <nav class="navbar navbar-expand-lg navbar-light me-3">
                <div class="navbar-nav">
                    <a class="nav-link" href="/services/">Services</a>
                    <a class="nav-link" href="/how-it-works/">How it Works</a>
                    <a class="nav-link" href="/become-vendor/">Become a Vendor</a>
                </div>
            </nav>
            <a href="/my-orders/" class="btn btn-outline-primary me-2" id="myOrdersBtn" style="display: none;">My Orders</a>
            <a href="/accounts/profile/" class="btn btn-outline-secondary me-2" id="myProfileBtn" style="display: none;">My Profile</a>
            <a href="#" class="login-btn" id="loginBtn">Login / Sign Up</a>
            <div class="dropdown" id="userDropdown" style="display: none;">
                <button class="btn btn-outline-primary dropdown-toggle" type="button" id="welcomeBtn" data-bs-toggle="dropdown" aria-expanded="false">
                    Welcome, <span id="userName"></span>
                </button>
                <ul class="dropdown-menu" aria-labelledby="welcomeBtn">
                    <li><a class="dropdown-item" href="/accounts/profile/"><i class="fas fa-user me-2"></i>My Profile</a></li>
                    <li><a class="dropdown-item" href="/my-orders/"><i class="fas fa-box me-2"></i>My Orders</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li><a class="dropdown-item text-danger" href="/accounts/logout/"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                </ul>
            </div>
        </div>
    </div>
    <!-- Order Guided Form -->
    <div class="order-tabs-compartment text-center">
        <div class="row justify-content-center mb-4">
            <div class="col-md-6">
                <div class="btn-group w-100 mb-3" role="group">
                    <button type="button" class="btn btn-primary" id="smallOrderBtn">Small Order</button>
                    <button type="button" class="btn btn-outline-primary" id="bulkOrderBtn">Bulk Order</button>
                </div>
                <div id="orderFormCard" class="card p-4">
                    <div id="orderProgress" class="mb-4">
                        <div class="progress">
                            <div class="progress-bar" role="progressbar" style="width: 25%" id="progressBar"></div>
                        </div>
                        <div class="d-flex justify-content-between mt-2">
                            <small id="stepLabel">Select Service</small>
                            <small>Step <span id="stepNum">1</span>/4</small>
                        </div>
                    </div>
                    <form id="orderForm">
                        <!-- Step 1: Service Selection -->
                        <div class="order-step" id="step1">
                            <h5 class="mb-3">What service do you need?</h5>
                            <div class="row">
                                <div class="col-6 col-md-4 mb-2">
                                    <button type="button" class="btn btn-outline-secondary w-100 service-btn" data-service="Tube Laser Cutting"><i class="fa-solid fa-bore-hole me-2"></i>Tube Laser Cutting</button>
                                </div>
                                <div class="col-6 col-md-4 mb-2">
                                    <button type="button" class="btn btn-outline-secondary w-100 service-btn" data-service="Sheet Laser Cutting"><i class="fa-solid fa-layer-group me-2"></i>Sheet Laser Cutting</button>
                                </div>
                                <div class="col-6 col-md-4 mb-2">
                                    <button type="button" class="btn btn-outline-secondary w-100 service-btn" data-service="CNC Machining"><i class="fa-solid fa-cogs me-2"></i>CNC Machining</button>
                                </div>
                                <div class="col-6 col-md-6 mb-2">
                                    <button type="button" class="btn btn-outline-secondary w-100 service-btn" data-service="VMC Machining"><i class="fa-solid fa-industry me-2"></i>VMC Machining</button>
                                </div>
                                <div class="col-6 col-md-6 mb-2">
                                    <button type="button" class="btn btn-outline-secondary w-100 service-btn" data-service="3D Printing"><i class="fa-solid fa-cube me-2"></i>3D Printing</button>
                                </div>
                            </div>
                        </div>
                        <!-- Step 2: File Upload -->
                        <div class="order-step d-none" id="step2">
                            <h5 class="mb-3">Upload your file</h5>
                            <input class="form-control mb-3" type="file" id="orderFile" required>
                            <button type="button" class="btn btn-secondary" id="backToStep1">Back</button>
                            <button type="button" class="btn btn-primary ms-2" id="toStep3">Next</button>
                        </div>
                        <!-- Step 3: Contact Info -->
                        <div class="order-step d-none" id="step3">
                            <h5 class="mb-3">Your Contact Information</h5>
                            <input class="form-control mb-2" type="text" id="orderName" placeholder="Your Name (optional)">
                            <input class="form-control mb-2" type="email" id="orderEmail" placeholder="Email (optional)">
                            <input class="form-control mb-3" type="tel" id="orderPhone" placeholder="Phone (optional)">
                            <button type="button" class="btn btn-secondary" id="backToStep2">Back</button>
                            <button type="button" class="btn btn-primary ms-2" id="toStep4">Submit</button>
                        </div>
                        <!-- Step 4: Confirmation -->
                        <div class="order-step d-none" id="step4">
                            <h5 class="mb-3 text-success">Thank you!</h5>
                            <p>Your Project No. is <span id="projectNo"></span>.</p>
                            <p>We will get back to you with a quote in few minutes. For any further information to share, please email to us at <b>info@tubematic.in</b> with your Project No.</p>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <!-- Services -->
    <div class="services-compartment">
        <h2 class="text-center mb-4">Our Services</h2>
        <div class="row justify-content-center">
            <div class="col-md-2 col-6 mb-3">
                <div class="card service-card text-center p-3">
                    <i class="fa-solid fa-bore-hole service-icon"></i>
                    <h6 class="mt-2">Tube Laser Cutting</h6>
                    <small>Precision cutting for tubes and pipes of all shapes.</small>
                </div>
            </div>
            <div class="col-md-2 col-6 mb-3">
                <div class="card service-card text-center p-3">
                    <i class="fa-solid fa-layer-group service-icon"></i>
                    <h6 class="mt-2">Sheet Laser Cutting</h6>
                    <small>High-speed, accurate cutting for sheet metals.</small>
                </div>
            </div>
            <div class="col-md-2 col-6 mb-3">
                <div class="card service-card text-center p-3">
                    <i class="fa-solid fa-cogs service-icon"></i>
                    <h6 class="mt-2">CNC Machining</h6>
                    <small>Complex parts with tight tolerances and finishes.</small>
                </div>
            </div>
            <div class="col-md-2 col-6 mb-3">
                <div class="card service-card text-center p-3">
                    <i class="fa-solid fa-industry service-icon"></i>
                    <h6 class="mt-2">VMC Machining</h6>
                    <small>Vertical machining for high-precision components.</small>
                </div>
            </div>
            <div class="col-md-2 col-6 mb-3">
                <div class="card service-card text-center p-3">
                    <i class="fa-solid fa-cube service-icon"></i>
                    <h6 class="mt-2">3D Printing</h6>
                    <small>Rapid prototyping and production with 3D printing.</small>
                </div>
            </div>
        </div>
    </div>
    <!-- Why Choose Carrigar -->
    <div class="why-compartment text-center">
        <h2 class="mb-4">Why Choose Carrigar?</h2>
        <div class="row justify-content-center">
            <div class="col-md-3 mb-3">
                <i class="fa-solid fa-bolt fa-2x mb-2 text-primary"></i>
                <h6>Speed & Precision</h6>
                <small>Fast turnaround and unmatched accuracy for every project.</small>
            </div>
            <div class="col-md-3 mb-3">
                <i class="fa-solid fa-headset fa-2x mb-2 text-primary"></i>
                <h6>Expert Support</h6>
                <small>Our engineers guide you from design to delivery.</small>
            </div>
            <div class="col-md-3 mb-3">
                <i class="fa-solid fa-lightbulb fa-2x mb-2 text-primary"></i>
                <h6>Innovation</h6>
                <small>Cutting-edge technology for modern manufacturing needs.</small>
            </div>
            <div class="col-md-3 mb-3">
                <i class="fa-solid fa-award fa-2x mb-2 text-primary"></i>
                <h6>Quality Assurance</h6>
                <small>Strict quality checks for reliable, consistent results.</small>
            </div>
        </div>
    </div>
    <!-- Tube Laser Transformation -->
    <div class="tube-laser-compartment text-center">
        <h2 class="mb-3">How Tube Lasers Can Transform Your Business</h2>
        <p class="lead">Unlock new design possibilities, reduce waste, and accelerate production with advanced tube laser technology. Carrigar empowers your business to achieve more with less, delivering complex geometries and perfect finishes at scale.</p>
    </div>
    <!-- Testimonials -->
    <div class="testimonials-compartment">
        <h3 class="text-center mb-4">Testimonials</h3>
        <div id="testimonialCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
                <button type="button" data-bs-target="#testimonialCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                <button type="button" data-bs-target="#testimonialCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                <button type="button" data-bs-target="#testimonialCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
            </div>
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <div class="d-flex flex-column align-items-center">
                        <p class="lead">"Carrigar's precision and speed are unmatched. Highly recommended!"</p>
                        <span class="fw-bold">- Godrej Interio</span>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="d-flex flex-column align-items-center">
                        <p class="lead">"Excellent service and support from the engineering team."</p>
                        <span class="fw-bold">- Nilkamal</span>
                    </div>
                </div>
                <div class="carousel-item">
                    <div class="d-flex flex-column align-items-center">
                        <p class="lead">"Our go-to partner for all custom manufacturing needs."</p>
                        <span class="fw-bold">- HCTSun</span>
                    </div>
                </div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#testimonialCarousel" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#testimonialCarousel" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
    <!-- Clients -->
    <div class="clients-compartment text-center">
        <h3 class="mb-4">Our Clients</h3>
        <div class="d-flex flex-wrap justify-content-center align-items-center">
            <div class="client-logo">Godrej Interio</div>
            <div class="client-logo">Godrej Security Solutions</div>
            <div class="client-logo">Nilkamal</div>
            <div class="client-logo">HCTSun</div>
        </div>
    </div>
</div>

<!-- Footer -->
<footer class="footer mt-5 py-5" style="background: linear-gradient(135deg, #1e293b 0%, #334155 100%); color: white;">
    <div class="container">
        <div class="row">
            <div class="col-lg-4 mb-4">
                <h5 class="mb-3">Carrigar by Tubematic</h5>
                <p class="text-light">Precision manufacturing solutions for all your industrial needs. Quality, reliability, and innovation at every step.</p>
            </div>
            <div class="col-lg-4 mb-4">
                <h6 class="mb-3">Office Address</h6>
                <p class="text-light mb-2">
                    <i class="fas fa-map-marker-alt me-2"></i>
                    Tubematic India Private Limited<br>
                    Virar, Maharashtra, India
                </p>
                <p class="text-light mb-2">
                    <i class="fas fa-envelope me-2"></i>
                    <a href="mailto:info@tubematic.in" class="text-light text-decoration-none">info@tubematic.in</a>
                </p>
            </div>
            <div class="col-lg-4 mb-4">
                <h6 class="mb-3">Follow Us</h6>
                <div class="social-links">
                    <a href="#" class="text-light me-3 fs-4"><i class="fab fa-instagram"></i></a>
                    <a href="#" class="text-light me-3 fs-4"><i class="fab fa-linkedin"></i></a>
                    <a href="#" class="text-light me-3 fs-4"><i class="fab fa-facebook"></i></a>
                    <a href="#" class="text-light me-3 fs-4"><i class="fab fa-x-twitter"></i></a>
                </div>
            </div>
        </div>
        <hr class="my-4" style="border-color: #64748b;">
        <div class="row align-items-center">
            <div class="col-md-6">
                <p class="mb-0 text-light">
                    <strong>Carrigar</strong> - Copyright Ⓒ <strong>TUBEMATIC INDIA PRIVATE LIMITED</strong><br>
                    All rights reserved 2025
                </p>
            </div>
            <div class="col-md-6 text-md-end">
                <p class="mb-0 text-light">
                    <small>Precision • Quality • Innovation</small>
                </p>
            </div>
        </div>
    </div>
</footer>

<!-- Login/Signup Modal -->
<div class="modal fade" id="authModal" tabindex="-1" aria-labelledby="authModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="authModalLabel">Login / Sign Up</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <ul class="nav nav-tabs" id="authTab" role="tablist">
                    <li class="nav-item" role="presentation">
                        <button class="nav-link active" id="login-tab" data-bs-toggle="tab" data-bs-target="#login" type="button" role="tab">Login</button>
                    </li>
                    <li class="nav-item" role="presentation">
                        <button class="nav-link" id="signup-tab" data-bs-toggle="tab" data-bs-target="#signup" type="button" role="tab">Sign Up</button>
                    </li>
                </ul>
                <div class="tab-content mt-3" id="authTabContent">
                    <div class="tab-pane fade show active" id="login" role="tabpanel">
                        <form id="loginForm">
                            <div class="mb-3">
                                <label for="loginEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="loginEmail" required>
                            </div>
                            <div class="mb-3">
                                <label for="loginPassword" class="form-label">Password</label>
                                <input type="password" class="form-control" id="loginPassword" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 mb-3">Login</button>
                            
                            <!-- Google Login Button -->
                            <div class="text-center">
                                <p class="text-muted mb-2">Or login with</p>
                                <a href="/accounts/google/login/" class="btn btn-outline-secondary w-100">
                                    <i class="fab fa-google me-2"></i>Continue with Google
                                </a>
                            </div>
                        </form>
                    </div>
                    <div class="tab-pane fade" id="signup" role="tabpanel">
                        <form id="signupForm">
                            <div class="mb-3">
                                <label for="signupName" class="form-label">Full Name</label>
                                <input type="text" class="form-control" id="signupName" required>
                            </div>
                            <div class="mb-3">
                                <label for="signupEmail" class="form-label">Email</label>
                                <input type="email" class="form-control" id="signupEmail" required>
                            </div>
                            <div class="mb-3">
                                <label for="signupPhone" class="form-label">Phone Number</label>
                                <input type="tel" class="form-control" id="signupPhone" required>
                            </div>
                            <div class="mb-3">
                                <label for="signupProfileType" class="form-label">Profile Type</label>
                                <select class="form-select" id="signupProfileType">
                                    <option value="individual">Individual</option>
                                    <option value="company">Company</option>
                                </select>
                            </div>
                            <div id="signupCompanyFields" style="display: none;">
                                <div class="mb-3">
                                    <label for="signupCompanyName" class="form-label">Company Name</label>
                                    <input type="text" class="form-control" id="signupCompanyName">
                                </div>
                                <div class="mb-3">
                                    <label for="signupGST" class="form-label">GST Number</label>
                                    <input type="text" class="form-control" id="signupGST">
                                </div>
                                <div class="mb-3">
                                    <label for="signupBusinessAddress" class="form-label">Business Address</label>
                                    <textarea class="form-control" id="signupBusinessAddress"></textarea>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="signupAddress" class="form-label">Personal Address</label>
                                <textarea class="form-control" id="signupAddress"></textarea>
                            </div>
                            <div class="mb-3">
                                <label for="signupPassword" class="form-label">Password</label>
                                <input type="password" class="form-control" id="signupPassword" required>
                            </div>
                            <div class="mb-3">
                                <label for="signupConfirmPassword" class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" id="signupConfirmPassword" required>
                            </div>
                            <button type="submit" class="btn btn-primary w-100 mb-3">Sign Up</button>
                            <div class="text-center">
                                <p class="text-muted mb-2">Or sign up with</p>
                                <a href="/accounts/google/login/" class="btn btn-outline-secondary w-100">
                                    <i class="fab fa-google me-2"></i>Continue with Google
                                </a>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
// Guided form logic
let currentStep = 1;
let selectedService = '';
let orderType = 'small';
function showStep(step) {
    document.querySelectorAll('.order-step').forEach((el, idx) => {
        el.classList.toggle('d-none', idx !== step - 1);
    });
    document.getElementById('progressBar').style.width = (step * 25) + '%';
    document.getElementById('stepNum').innerText = step;
    const labels = ['Select Service', 'Upload File', 'Contact Info', 'Confirmation'];
    document.getElementById('stepLabel').innerText = labels[step - 1];
}
document.querySelectorAll('.service-btn').forEach(btn => {
    btn.onclick = function() {
        selectedService = btn.getAttribute('data-service');
        showStep(2);
        currentStep = 2;
    };
});
document.getElementById('toStep3').onclick = function() {
    showStep(3);
    currentStep = 3;
};
document.getElementById('toStep4').onclick = function() {
    // Create order in backend
    const orderData = {
        order_type: orderType,
        service_type: selectedService,
        contact_name: document.getElementById('orderName').value,
        contact_email: document.getElementById('orderEmail').value,
        contact_phone: document.getElementById('orderPhone').value
    };
    let createdOrder = null;
    fetch('/create-order/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify(orderData)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            createdOrder = data;
            // Upload file if selected
            const fileInput = document.getElementById('orderFile');
            if (fileInput.files.length > 0) {
                const formData = new FormData();
                formData.append('file', fileInput.files[0]);
                formData.append('order_id', data.order_id);
                return fetch('/upload-file/', {
                    method: 'POST',
                    body: formData
                });
            } else {
                return Promise.resolve({ ok: true, json: () => ({ success: true }) });
            }
        } else if (data.require_login) {
            // Show login modal for bulk orders
            alert('Please login to place bulk orders. You will be redirected to the login page.');
            const authModal = new bootstrap.Modal(document.getElementById('authModal'));
            authModal.show();
            throw new Error('Login required');
        } else {
            throw new Error(data.message);
        }
    })
    .then(response => response.json())
    .then(fileData => {
        if (fileData.success) {
            // Show confirmation with project number
            const projectNo = createdOrder.project_number;
            document.getElementById('projectNo').innerText = projectNo;
            showStep(4);
            currentStep = 4;
        } else {
            alert('File upload failed: ' + fileData.message);
        }
    })
    .catch(error => {
        if (error.message !== 'Login required') {
            console.error('Error:', error);
            alert('Order creation failed: ' + error.message);
        }
    });
};
document.getElementById('backToStep1').onclick = function() {
    showStep(1);
    currentStep = 1;
};
document.getElementById('backToStep2').onclick = function() {
    showStep(2);
    currentStep = 2;
};
document.getElementById('smallOrderBtn').onclick = function() {
    orderType = 'small';
    document.getElementById('smallOrderBtn').classList.add('btn-primary');
    document.getElementById('smallOrderBtn').classList.remove('btn-outline-primary');
    document.getElementById('bulkOrderBtn').classList.remove('btn-primary');
    document.getElementById('bulkOrderBtn').classList.add('btn-outline-primary');
    showStep(1);
};
document.getElementById('bulkOrderBtn').onclick = function() {
    orderType = 'bulk';
    document.getElementById('bulkOrderBtn').classList.add('btn-primary');
    document.getElementById('bulkOrderBtn').classList.remove('btn-outline-primary');
    document.getElementById('smallOrderBtn').classList.remove('btn-primary');
    document.getElementById('smallOrderBtn').classList.add('btn-outline-primary');
    showStep(1);
};
showStep(1);

// Authentication modal functionality
document.getElementById('loginBtn').addEventListener('click', function(e) {
    e.preventDefault();
    const authModal = new bootstrap.Modal(document.getElementById('authModal'));
    authModal.show();
});

// Login form submission
document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    fetch('/accounts/login/', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            email: email,
            password: password
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            alert('Login successful! Welcome, ' + data.user.name);
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userDropdown').style.display = 'inline-block';
            document.getElementById('userName').textContent = data.user.name;
            bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
        } else {
            alert('Login failed: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Login failed. Please try again.');
    });
});

// Signup form submission
document.getElementById('signupForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const name = document.getElementById('signupName').value;
    const email = document.getElementById('signupEmail').value;
    const phone = document.getElementById('signupPhone').value;
    const password = document.getElementById('signupPassword').value;
    const confirmPassword = document.getElementById('signupConfirmPassword').value;
    const profileType = document.getElementById('signupProfileType').value;
    const is_company = profileType === 'company';
    const company_name = document.getElementById('signupCompanyName').value;
    const gst_number = document.getElementById('signupGST').value;
    const business_address = document.getElementById('signupBusinessAddress').value;
    const address = document.getElementById('signupAddress').value;
    if (password !== confirmPassword) {
        alert('Passwords do not match!');
        return;
    }
    fetch('/accounts/signup/', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', },
        body: JSON.stringify({
            name: name,
            email: email,
            phone: phone,
            password: password,
            is_company: is_company,
            company_name: company_name,
            gst_number: gst_number,
            business_address: business_address,
            address: address
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userDropdown').style.display = 'inline-block';
            document.getElementById('userName').textContent = data.user.name;
            bootstrap.Modal.getInstance(document.getElementById('authModal')).hide();
        } else {
            alert('Signup failed: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('Signup failed. Please try again.');
    });
});

// Check authentication status on page load
document.addEventListener('DOMContentLoaded', function() {
    fetch('/accounts/check-auth/')
    .then(response => response.json())
    .then(data => {
        if (data.authenticated) {
            document.getElementById('loginBtn').style.display = 'none';
            document.getElementById('userDropdown').style.display = 'inline-block';
            document.getElementById('userName').textContent = data.user.name;
        }
    })
    .catch(error => {
        console.error('Error checking auth:', error);
    });
});

document.getElementById('signupProfileType').addEventListener('change', function() {
    document.getElementById('signupCompanyFields').style.display = this.value === 'company' ? 'block' : 'none';
});
</script>
</body>
</html> 